<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>Haojen's blog</title><meta name="description" content="May the Force be with you"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/widget-post-list.css"><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Hexo & github" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Haojen's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><span>分类 · Nacos</span></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><article class="post-container is-flex is-justify-content-center section container is-max-widescreen pt-4 px-2"><div class="columns is-variable is-1-tablet is-3-desktop-only is-2-widescreen is-full-width"><section class="column"><article class="post-item-card"><header class="is-relative is-flex"><div class="post-cover-backdrop is-hidden"><img src="/../../images/image-20210409210621117.png" alt="loading.."></div><a class="post-cover-link has-text-centered skeleton" href="/2023/02/09/Nacos/Nacos-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><img class="post-cover-img js-img-fadeIn" src="/../../images/image-20210409210621117.png" alt="loading.." data-backdrop="true"></a></header><section class="content post-card-content p-4 pb-5"><header><a href="/tags/Nacos"><i class="tag post-item-tag">Nacos</i></a></header><h2 class="mt-4 mb-0 is-family-serif"><a href="/2023/02/09/Nacos/Nacos-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">Nacos-集群搭建</a></h2><time class="has-text-grey" datetime="2023-02-09T03:44:24.155Z">2023-02-09</time><p class="is-flex-grow-2 mt-2">Nacos集群搭建1.集群结构图官方给出的Nacos集群图：

其中包含3个nacos节点，然后一个负载均衡器代理3个Nacos。这里负载均衡器可以使用nginx。
我们计划的集群结构：

三个nacos节点的地址：



节点
ip
port



nacos1
192.168.150.1
8845


nacos2
192.168.150.1
8846


nacos3
192.168.150.1
8847


2.搭建集群搭建集群的基本步骤：

搭建数据库，初始化数据库表结构
下载nacos安装包
配置nacos
启动nacos集群
nginx反向代理

2.1.初始化数据库Nacos默认数据存储在内嵌数据库Derby中，不属于生产可用的数据库。
官方推荐的最佳实践是使用带有主从的高可用数据库集群，主..</p><a class="button is-default mt-2 has-text-weight-semibold" href="/2023/02/09/Nacos/Nacos-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">更多</a></section></article><article class="post-item-card"><header class="is-relative is-flex"><div class="post-cover-backdrop is-hidden"><img src="/../../images/image-20230208175614453.png" alt="loading.."></div><a class="post-cover-link has-text-centered skeleton" href="/2023/02/08/Nacos/Nacos-%E6%B3%A8%E5%86%8C%E7%BB%86%E8%8A%82%E4%BB%A5%E5%8F%8A%E4%B8%8EEureka%E7%9A%84%E6%AF%94%E8%BE%83/"><img class="post-cover-img js-img-fadeIn" src="/../../images/image-20230208175614453.png" alt="loading.." data-backdrop="true"></a></header><section class="content post-card-content p-4 pb-5"><header><a href="/tags/Nacos"><i class="tag post-item-tag">Nacos</i></a></header><h2 class="mt-4 mb-0 is-family-serif"><a href="/2023/02/08/Nacos/Nacos-%E6%B3%A8%E5%86%8C%E7%BB%86%E8%8A%82%E4%BB%A5%E5%8F%8A%E4%B8%8EEureka%E7%9A%84%E6%AF%94%E8%BE%83/">Nacos-注册细节以及与Eureka的比较</a></h2><time class="has-text-grey" datetime="2023-02-08T10:17:38.381Z">2023-02-08</time><p class="is-flex-grow-2 mt-2">Nacos注册细节
相比Eureka，Nacos可以主动推送变更消息push，nacos注册中心一当发现有服务挂了，会立即向服务消费者发送服务变更消息，让服务消费者能及时跟新，跟新的效率更高些，时效性好些。


不是临时实例，即便服务程序关闭之后，还在这里，只是标红表示不是健康状态，等待着我们启动它

再重新启动服务，上面的服务就会回复健康状态了


Nacos与eureka的共同点
都支持服务注册和服务拉取
都支持服务提供者心跳方式做健康检测总结


Nacos与Eureka的区别
Nacos支持服务端主动检测提供者状态 : 临时实例采用心跳模式，非临时实例采用主动检测模式（但是主动检测对服务器压力会比较大，所以更建议使用临时实例）
临时实例心跳不正常会被剔除，非临时实例则不会被剔除
Naco支持主动服务..</p><a class="button is-default mt-2 has-text-weight-semibold" href="/2023/02/08/Nacos/Nacos-%E6%B3%A8%E5%86%8C%E7%BB%86%E8%8A%82%E4%BB%A5%E5%8F%8A%E4%B8%8EEureka%E7%9A%84%E6%AF%94%E8%BE%83/">更多</a></section></article><article class="post-item-card"><header class="is-relative is-flex"><div class="post-cover-backdrop is-hidden"><img src="/../../images/image-20230209095809931.png" alt="loading.."></div><a class="post-cover-link has-text-centered skeleton" href="/2023/02/08/Nacos/Nacos-%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/"><img class="post-cover-img js-img-fadeIn" src="/../../images/image-20230209095809931.png" alt="loading.." data-backdrop="true"></a></header><section class="content post-card-content p-4 pb-5"><header><a href="/tags/Nacos"><i class="tag post-item-tag">Nacos</i></a></header><h2 class="mt-4 mb-0 is-family-serif"><a href="/2023/02/08/Nacos/Nacos-%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">Nacos-实现配置管理</a></h2><time class="has-text-grey" datetime="2023-02-08T09:54:16.430Z">2023-02-08</time><p class="is-flex-grow-2 mt-2">


配置好后就会出现在配置列表中

上面就是已经把部分的配置放到了Nacos的服务器了，下面介绍微服务怎样得到Nacos上那些配置
首先项目要知道，去哪读取，读取谁？
bootstrap.yml的优先级会比application.yml的优先级高很多
与Nacos的地址和配置文件有关的信息都应该放到bootstrap.yml文件中




配置热更新
在开发中也比较建议用方式二



多环境配置共享
添加多环境共享配置

多种配置的优先级：


</p><a class="button is-default mt-2 has-text-weight-semibold" href="/2023/02/08/Nacos/Nacos-%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">更多</a></section></article><article class="post-item-card"><header class="is-relative is-flex"><div class="post-cover-backdrop is-hidden"><img src="/../../images/image-20230208173305495.png" alt="loading.."></div><a class="post-cover-link has-text-centered skeleton" href="/2023/02/08/Nacos/Nacos-namespace%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB/"><img class="post-cover-img js-img-fadeIn" src="/../../images/image-20230208173305495.png" alt="loading.." data-backdrop="true"></a></header><section class="content post-card-content p-4 pb-5"><header><a href="/tags/Nacos"><i class="tag post-item-tag">Nacos</i></a></header><h2 class="mt-4 mb-0 is-family-serif"><a href="/2023/02/08/Nacos/Nacos-namespace%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB/">Nacos-namespace环境隔离</a></h2><time class="has-text-grey" datetime="2023-02-08T09:25:24.848Z">2023-02-08</time><p class="is-flex-grow-2 mt-2">

Nacos环境隔离

namespace用来做环境隔离

每个namespace都有唯一id

不同namespace下的服务不可见不可互相访问







不同namespace（命名空间）下的服务是不可见的，要想访问，必须放到同一个namespace下








</p><a class="button is-default mt-2 has-text-weight-semibold" href="/2023/02/08/Nacos/Nacos-namespace%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB/">更多</a></section></article><article class="post-item-card"><header class="is-relative is-flex"><div class="post-cover-backdrop is-hidden"><img src="/../../images/image-20230208162844861.png" alt="loading.."></div><a class="post-cover-link has-text-centered skeleton" href="/2023/02/08/Nacos/Nacos-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E4%BE%8B%E7%9A%84%E6%9D%83%E9%87%8D%E8%AE%BE%E7%BD%AE/"><img class="post-cover-img js-img-fadeIn" src="/../../images/image-20230208162844861.png" alt="loading.." data-backdrop="true"></a></header><section class="content post-card-content p-4 pb-5"><header><a href="/tags/Nacos"><i class="tag post-item-tag">Nacos</i></a></header><h2 class="mt-4 mb-0 is-family-serif"><a href="/2023/02/08/Nacos/Nacos-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E4%BE%8B%E7%9A%84%E6%9D%83%E9%87%8D%E8%AE%BE%E7%BD%AE/">Nacos-服务实例的权重设置</a></h2><time class="has-text-grey" datetime="2023-02-08T07:29:48.506Z">2023-02-08</time><p class="is-flex-grow-2 mt-2">先分析为何要用权重设置：​		集群优先的负载均衡，不过呢，我们部署的时候啊，可能会存在这么一种情况，因为企业里服务器设备啊，会更新迭代，有一些机器呢，性能比较好，还有一些属于是祖传设备了，性能非常的差，可以说是老弱病残，这个时候呢，我们肯定是希望这些性能好的机器，它承担更多的用户请求，而那些性能差一点的，自然是承担少一点的请求，正所谓能者多劳嘛。但是我们目前看来，NacosRule做到的是集群优先，而后做随机，当用户请求来了以后，它可不管你是性格好的还是差，这个身强力壮的还是老弱病残拉过来就一顿造，那这个时候那些性能差的肯定就会出问题。那么我们该怎样去控制不同服务它的一个请求量呢？哎，Nacos，给我们提供了一个权重的配置，通过修改服务实力的权重，可以控制访问频率，权重越大，访问到的频率就越高，那我们就可以..</p><a class="button is-default mt-2 has-text-weight-semibold" href="/2023/02/08/Nacos/Nacos-%E6%9C%8D%E5%8A%A1%E5%AE%9E%E4%BE%8B%E7%9A%84%E6%9D%83%E9%87%8D%E8%AE%BE%E7%BD%AE/">更多</a></section></article><article class="post-item-card"><header class="is-relative is-flex"><div class="post-cover-backdrop is-hidden"><img src="/../../images/image-20230208114620776.png" alt="loading.."></div><a class="post-cover-link has-text-centered skeleton" href="/2023/02/08/Nacos/Nacos-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E7%BA%A7%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/"><img class="post-cover-img js-img-fadeIn" src="/../../images/image-20230208114620776.png" alt="loading.." data-backdrop="true"></a></header><section class="content post-card-content p-4 pb-5"><header><a href="/tags/Nacos"><i class="tag post-item-tag">Nacos</i></a></header><h2 class="mt-4 mb-0 is-family-serif"><a href="/2023/02/08/Nacos/Nacos-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E7%BA%A7%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">Nacos-服务多级存储模式 &amp; 集群 &amp; 优先本地集群访问的负载均衡的实现</a></h2><time class="has-text-grey" datetime="2023-02-08T03:33:44.757Z">2023-02-08</time><p class="is-flex-grow-2 mt-2">​		之前我们有服务的概念，我们提供用户查询的userservice服务，还有提供订单查询的orderservice服务。然后，userservice还部署了多个实例，我们有8081 、8082、8083，这三个呢，都是userservice的实例，所以我们之前是有两层概念的，一层是服务，而第二层就是实例。一个服务，可以包含多个实例。不过呀，随着我们这个业务规模越来越扩大，那么我们就会考虑更多的问题了。比如说我们现在的，我们把所有的实力都部署在一个地方，就像你把鸡蛋都放在一个篮子里，哪天你不小心篮子翻了，那所有的鸡蛋不就都打碎了吗？那你的机房放在那里同一个地方，哪天天灾人祸出了问题，整个服务不就完了？所以呀，为了解决这个问l题，我们会将一个服务的多个实例部署到多个机房，特别是像阿里京东这些财大气粗的，哎，我..</p><a class="button is-default mt-2 has-text-weight-semibold" href="/2023/02/08/Nacos/Nacos-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E7%BA%A7%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B/">更多</a></section></article></section><aside class="column is-hidden-mobile is-4-tablet is-3-widescreen"><div style="position: sticky; top: 50px;"><main class="aside-card-container categories-widget category-page"><h3>分类</h3><section><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nacos/">Nacos</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Netty/">Netty</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringSecurity/">SpringSecurity</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/debug/">debug</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo%E5%8D%9A%E5%AE%A2/">hexo博客</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/interview/">interview</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/juc/">juc</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatisplus/">mybatisplus</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/springboot/">springboot</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/">sql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/token/">token</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/">云服务器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%B7%E9%A2%98/">刷题</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8%E6%80%A7/">安全性</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/">定时任务</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%82%E5%B8%B8or%E6%8A%A5%E9%94%99/">异常or报错</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85/">数据封装</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/">文件服务器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/">远程调用</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9B%B6%E7%A2%8E%E7%9F%A5%E8%AF%86-%E7%AC%94%E8%AE%B0/">零碎知识&笔记</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题</a><span class="category-list-count">13</span></li></ul></section></main></div></aside></div></article><script>$claudia.fadeInImage(null, $claudia.blurBackdropImg)

window.addEventListener('resize', $claudia.throttle(function () {
    var images = document.querySelectorAll('.js-img-fadeIn')

    images.forEach($claudia.blurBackdropImg)
}, 150))</script></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/haojen"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Haojen 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script>$claudia.fadeInImage(null, $claudia.blurBackdropImg)

window.addEventListener('resize', $claudia.throttle(function () {
    var images = document.querySelectorAll('.js-img-fadeIn')

    images.forEach($claudia.blurBackdropImg)
}, 150))</script></body></html>